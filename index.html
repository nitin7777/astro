<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Astrology App</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Google Sign-In and JWT decode libraries -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jwt-decode/3.1.2/jwt-decode.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <!-- React and Babel from CDN -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <script type="text/babel">
    function getZodiac(month, day) {
      const date = month * 100 + day;
      if (date >= 321 && date <= 419) return "Aries";
      if (date >= 420 && date <= 520) return "Taurus";
      if (date >= 521 && date <= 620) return "Gemini";
      if (date >= 621 && date <= 722) return "Cancer";
      if (date >= 723 && date <= 822) return "Leo";
      if (date >= 823 && date <= 922) return "Virgo";
      if (date >= 923 && date <= 1022) return "Libra";
      if (date >= 1023 && date <= 1121) return "Scorpio";
      if (date >= 1122 && date <= 1221) return "Sagittarius";
      if ((date >= 1222 && date <= 1231) || (date >= 101 && date <= 119)) return "Capricorn";
      if (date >= 120 && date <= 218) return "Aquarius";
      if (date >= 219 && date <= 320) return "Pisces";
      return "Unknown";
    }

    function getVedicSign(month, day) {
      const signs = ["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];
      const western = getZodiac(month, day);
      const idx = signs.indexOf(western);
      const vedicIdx = (idx + 11) % 12; // simple shift for sidereal sign
      return signs[vedicIdx];
    }

    function getLifePathNumber(year, month, day) {
      const digits = ("" + year + month + day).split("");
      let sum = digits.reduce((s, d) => s + parseInt(d, 10), 0);
      const reduce = (num) => {
        while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
          num = num.toString().split("").reduce((s, d) => s + parseInt(d, 10), 0);
        }
        return num;
      };
      return reduce(sum);
    }

    const descriptions = {
      Aries: "Energetic, candid, and willful.",
      Taurus: "Reliable, diligent, and conservative.",
      Gemini: "Quick-witted, capricious, and cheerful.",
      Cancer: "Considerate, imaginative, and sensitive.",
      Leo: "Enthusiastic, proud, and expansive.",
      Virgo: "Elegant, perfectionist, and organized.",
      Libra: "Just, kind, and diplomatic.",
      Scorpio: "Insightful, mysterious, and passionate.",
      Sagittarius: "Unconstrained, lively, and optimistic.",
      Capricorn: "Practical, prudent, and patient.",
      Aquarius: "Unique, wise, and idealistic.",
      Pisces: "Romantic, kind, and gentle.",
    };

    function AstroApp() {
      const [month, setMonth] = React.useState(1);
      const [day, setDay] = React.useState(1);
      const [year, setYear] = React.useState(2000);
      const [sign, setSign] = React.useState(null);
      const [vedicSign, setVedicSign] = React.useState(null);
      const [lifePath, setLifePath] = React.useState(null);
      const [user, setUser] = React.useState(() => {
        const stored = localStorage.getItem('astroUser');
        return stored ? JSON.parse(stored) : null;
      });

      React.useEffect(() => {
        if (user) return;
        window.handleCredentialResponse = (response) => {
          const data = jwt_decode(response.credential);
          setUser(data);
          localStorage.setItem('astroUser', JSON.stringify(data));
        };
        google.accounts.id.initialize({
          client_id: 'YOUR_GOOGLE_CLIENT_ID', // replace with your client ID
          callback: handleCredentialResponse,
        });
        google.accounts.id.renderButton(
          document.getElementById('googleSignInButton'),
          { theme: 'outline', size: 'large' }
        );
      }, [user]);

      const handleSignOut = () => {
        setUser(null);
        localStorage.removeItem('astroUser');
        google.accounts.id.disableAutoSelect();
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        const m = parseInt(month, 10);
        const d = parseInt(day, 10);
        const y = parseInt(year, 10);
        const zodiac = getZodiac(m, d);
        const vedic = getVedicSign(m, d);
        const lp = getLifePathNumber(y, m, d);
        setSign(zodiac);
        setVedicSign(vedic);
        setLifePath(lp);
      };

      if (!user) {
        return (
          <div className="card">
            <h1>Astrology App</h1>
            <div id="googleSignInButton"></div>
          </div>
        );
      }

      return (
        <div className="card">
          <div className="header">
            <h2>Welcome {user.name}</h2>
            <button className="signout" onClick={handleSignOut}>Sign Out</button>
          </div>
          <form onSubmit={handleSubmit}>
            <div className="field">
              <label>Month</label>
              <input
                type="number"
                value={month}
                onChange={(e) => setMonth(e.target.value)}
                min="1"
                max="12"
                required
              />
            </div>
            <div className="field">
              <label>Day</label>
              <input
                type="number"
                value={day}
                onChange={(e) => setDay(e.target.value)}
                min="1"
                max="31"
                required
              />
            </div>
            <div className="field">
              <label>Year</label>
              <input
                type="number"
                value={year}
                onChange={(e) => setYear(e.target.value)}
                min="1900"
                max="2100"
                required
              />
            </div>
            <button type="submit">Calculate</button>
          </form>
          {sign && (
            <div className="result">
              <h2>Your Western Zodiac sign: {sign}</h2>
              <p>{descriptions[sign]}</p>
              <h3>Vedic (Moon) sign: {vedicSign}</h3>
              <h3>Life Path Number: {lifePath}</h3>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<AstroApp />, document.getElementById('root'));
  </script>
</body>
</html>
